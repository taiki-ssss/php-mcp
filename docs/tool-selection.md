# PHP MCP サーバー ツール選定ドキュメント

## 概要
このドキュメントは、PHP MCPサーバーに実装するツールの選定プロセスと最終決定を記録したものです。

## 選定基準

### 1. AIの使用頻度
AIがPHPコードを操作する際に、実際にどの程度使用するかを5段階で評価

### 2. PHP適合性
PHPの言語特性（名前空間、use文、動的型付けなど）に対する重要度

### 3. 実装難易度
既存のphp-parserを使用した場合の実装の複雑さ

### 4. 代替可能性
他のツールや手段で代替可能かどうか

## TypeScript MCPからの学び

mizchiさんのtypescript-mcpの分析から得られた重要な知見：

1. **構文チェックやAST取得は内部処理** - AIに直接公開する必要はない
2. **セマンティックな操作に特化** - 文字列置換ではなくAST操作
3. **実用的なツールセットに絞る** - AIが実際に使うものだけ提供

## ツール評価結果

### ✅ 採用ツール

#### 1. php_rename_symbol（最重要）
- **使用頻度**: ⭐⭐⭐⭐⭐ 最も頻繁に使用
- **PHP適合性**: ⭐⭐⭐⭐⭐ 必須機能
- **実装難易度**: ⭐⭐⭐ 中程度
- **理由**: 変数名、関数名、クラス名の変更は最も基本的なリファクタリング操作

#### 2. php_move_file
- **使用頻度**: ⭐⭐⭐⭐ 高い
- **PHP適合性**: ⭐⭐⭐⭐⭐ PSR-4対応で重要
- **実装難易度**: ⭐⭐⭐⭐ 高い（名前空間自動更新が必要）
- **理由**: PHPではファイルパスと名前空間が密接に関連しており、整合性維持が重要

#### 3. php_find_references
- **使用頻度**: ⭐⭐⭐⭐ 高い
- **PHP適合性**: ⭐⭐⭐⭐ 重要
- **実装難易度**: ⭐⭐⭐ 中程度
- **理由**: リネーム前の影響範囲確認や、コードの理解に必須

#### 4. php_get_symbols
- **使用頻度**: ⭐⭐⭐ 中程度
- **PHP適合性**: ⭐⭐⭐⭐ ファイル構造把握に有用
- **実装難易度**: ⭐⭐ 低い
- **理由**: ファイル内の構造を素早く把握するために必要

#### 5. php_organize_imports（Phase 2）
- **使用頻度**: ⭐⭐⭐⭐ 高い
- **PHP適合性**: ⭐⭐⭐⭐⭐ PHP特有の機能
- **実装難易度**: ⭐⭐ 低い
- **理由**: use文の整理はPHP開発で頻繁に必要となる作業

### ❌ 不採用ツール

#### php_check_syntax
- **不採用理由**: 構文エラーは各ツールの実行時に内部でチェックし、エラーとして返せば十分

#### php_get_ast
- **不採用理由**: デバッグ用途であり、AIが直接使用することはない

#### php_get_diagnostics
- **不採用理由**: 診断情報は操作実行時のエラーメッセージで十分

#### php_delete_symbol
- **不採用理由**: 破壊的すぎる操作で、誤使用のリスクが高い

#### php_get_type_at_symbol
- **不採用理由**: PHPの動的型付けにより、正確な型推論は困難

## 実装フェーズ

### Phase 1: MVP（最小実装）
必須の4ツールを実装し、基本的なリファクタリング機能を提供
1. php_rename_symbol
2. php_find_references
3. php_get_symbols
4. php_move_file

### Phase 2: 価値追加
PHPの開発効率を大幅に向上させる機能
5. php_organize_imports
6. php_get_definition

### Phase 3: 高度な機能
より複雑なリファクタリング操作
7. php_extract_method
8. php_extract_variable

## 実装における技術的考慮事項

### 1. シンボルテーブルの構築
- 全プロジェクトファイルをスキャンしてシンボル情報を収集
- 名前空間、クラス、関数、変数の依存関係を管理

### 2. PSR-4/PSR-0対応
- composer.jsonのautoload設定を解析
- ファイルパスと名前空間の対応関係を維持

### 3. use文の解析と更新
- 既存のuse文を解析して依存関係を把握
- ファイル移動やリネーム時に自動更新

### 4. エラーハンドリング
- 各操作の前に構文チェックを実行
- 失敗時は詳細なエラーメッセージを返す

## まとめ

PHP MCPサーバーは、**AIが実際に使用する4つの基本ツール**から開発を開始します。これらのツールは、PHPコードの安全なリファクタリングを可能にし、開発効率を大幅に向上させます。

typescript-mcpの成功事例を参考に、シンプルで実用的なツールセットを提供することで、AIによるPHPコード操作を効果的にサポートします。